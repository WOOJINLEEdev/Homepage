<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="postman.css">
    <title>WJ shopping!</title>
</head>
<body>
  <header class="header">
    <h1 class="header_title">
      <a href="postman.html" class="header_link"><span class="visually_hidden">LOGO</span></a>
    </h1>
    <div class="sign_and_cart">
      <a href="signin.html" class="signin_link"><div class="signin"><img src="user.png" class="signin_img" alt="sign in"><span class="visually_hidden">마이페이지</span></div></a>
      <a href="cart.html" class="cart_link"><div class="cart"><img src="shopping-cart.png" class="signin_img" alt="cart"><span class="visually_hidden">장바구니</span></div></a>
    </div>
  </header>

  <main class="main">
    <ul class="list_group">
      <li class="list" id="mainList">
        <div class="list_element">
            <a href="item_detail.html" class="image_link" id="imageLink">
                <div class="image_wrap">
                  <img class="test_img" alt="" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>
  
      <li class="list">
        <div class="list_element">
            <a href="item_detail.html" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
                
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>
      </ul>
  
      <ul class="second_group hide">
      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>

      <li class="list">
        <div class="list_element">
            <a href="#" class="image_link">
                <div class="image_wrap">
                  <img class="test_img" alt="" src= "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20baseProfile%3D%22full%22%20width%3D%22undefined%22%20height%3D%22undefined%22%3E%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22grey%22%2F%3E%20%20%3Ctext%20x%3D%220%22%20y%3D%2220%22%20font-size%3D%2220%22%20text-anchor%3D%22start%22%20fill%3D%22white%22%3Eundefinedxundefined%3C%2Ftext%3E%20%3C%2Fsvg%3E">
                </div>
              
            </a>
            <a href="#" class="image_dim"></a>
        </div>
      </li>
    </ul>
    
    <input type="button" class="more_btn" value="더보기">
  
  </main>

  <footer class="footer">
    <ul class="footer_menu">
        <li class="footer_menu_list"><a href="#" class="footer_link">이용약관</a></li>
        <li class="footer_menu_list"><a href="#" class="footer_link">이용안내</a></li>
        <li class="footer_menu_list"><a href="#" class="footer_link">커뮤니티</a></li>
    </ul>
    <address class="footer_address">
      주소: OO시 OO구 OOO로
    </address>
    <p class="footer_copyright">
        COPYRIGHT © <span class="footer_copyright_text">WOOJINLEEdev</span> All Right Reserved.
    </p>
</footer>

  <div id="loading">
    <img id="loading-image" src="Fading circles.gif" alt="Loading..." />
  </div>


  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="./jwt-decode.js"></script>

  <script>

  function goToItemDetail(itemId) {
      console.log("itemId:", itemId)
      // debugger;
      location.href = `item_detail.html?item_id=${itemId}`;
    }

  document.addEventListener("DOMContentLoaded", function() {
    const [_, userId] = window.location.search.substring(1).split("=");
    console.log("페이지 테스트", userId);

    console.log("콘솔 ㅎㅇ");
    console.log("테스트 postman");

  
    const userToken = localStorage.getItem("user_token");
    const userPass = localStorage.getItem("user_pass");
    const isLoggedIn = Boolean(userToken);
    if (isLoggedIn) {
      const $signin = document.querySelector(".signin");
    }

    // --- 숫자 3자리 콤마
    function toString(mileage) {
      console.log("숫자콤마");
      return mileage.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    }

  
    fetch("http://localhost:8282/v1/products")
    .then((response) => response.json())
    .then(data => {
        console.log(data);
        console.log(data[0].variants[0].price);

        const $listGroup = document.querySelector(".list_group");
        $listGroup.innerHTML = "";

        let productsHTML1 = "";
        for (let i = 0; i < data.length; i++) {
          productsHTML1 += `<li class="list" onclick="goToItemDetail('${data[i].id}')">
            <div class="list_element">
                <a class="image_link">
                    <div class="image_wrap">
                      <img class="test_img" alt="" src="${data[i].images[0].src}">
                    </div>
                </a>
                <a href="#" class="image_dim"></a>
              <p class="item_name ${[i]}">${data[i].name}</p>
              <p class="item_price" data-price="price">${toString(Number(data[i].variants[0].price))}원</p>
            </div>
          </li>`;

          console.log(data[i].name);
        }
        $listGroup.insertAdjacentHTML("beforeend", productsHTML1);
    })


    const accessToken = localStorage.getItem("access_token");
    if (accessToken) {

      const decoded = jwt_decode(accessToken);
      const userId = decoded.user.id;
      const $userId = decoded.user.user_id;

      console.log("decoded:", decoded)

      let sign_link = document.querySelector(".signin_link");
      sign_link.setAttribute("href", "mypage.html");


    fetch(`http://localhost:8282/v1/me/cart`, {
        method : "GET",
        mode: "cors",
        headers : {
            'Content-Type': 'application/json',
              Authorization : `Bearer ${accessToken}`
        }
    })
    .then((response) => response.json())
    .then(data => {
      console.log("cart:", data);
      console.log(data);
    });
  }

  
    const more = document.querySelector(".more_btn");
    let secondUl = document.querySelector(".second_group");

    more.addEventListener("click", () => {
      paging();
    })

    function paging() {
      fetch("http://localhost:8282/v1/products")
      .then((response) => response.json())
      .then(data => {
        console.log(data);
        console.log(data[0].variants[0].price);
        
        const $listGroup = document.querySelector(".list_group");

        let productsHTML2 = "";
        for (let i = 0; i < data.length; i++) {
          productsHTML2 += `<li class="list" onclick="goToItemDetail('${data[i].id}')">
            <div class="list_element">
                <a class="image_link">
                    <div class="image_wrap">
                      <img class="test_img" alt="" src="${data[i].images[0].src}">
                    </div>
                </a>
                <a href="#" class="image_dim"></a>
              <p class="item_name ${[i]}">${data[i].name}</p>
              <p class="item_price ${[i]}">${toString(Number(data[i].variants[0].price))}원</p>
            </div>
          </li>`;

          console.log(data[i].name);
        }
          $listGroup.insertAdjacentHTML("beforeend", productsHTML2);
        })
      }

    })   


  window.onload = async () => {

    const $main = document.getElementsByClassName("main")[0];
    $main.classList.add("hide");
    let response = await fetch("http://localhost:8282/v1/products");

    $main.classList.remove("hide");
    document.getElementById("loading").style.display = "none";

  }

  </script>
</body>
</html>